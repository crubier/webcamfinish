import{r as e,a as t}from"./vendor.de62f314.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(n){const o=new URL(e,location),r=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((n,l)=>{const a=new URL(e,o);if(self[t].moduleMap[a])return n(self[t].moduleMap[a]);const c=new Blob([`import * as m from '${a}';`,`${t}.moduleMap['${a}']=m;`],{type:"text/javascript"}),i=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(c),onerror(){l(new Error(`Failed to import: ${e}`)),r(i)},onload(){n(self[t].moduleMap[a]),r(i)}});document.head.appendChild(i)})),self[t].moduleMap={}}}("/webcamfinish/assets/");function n(){const[t,n]=e.useState(null),[o,r]=e.useState([]),l=e.useRef(!1);e.useRef(!1);const a=e.useRef(null),c=e.useRef(null),i=()=>{l.current=!1};return e.useEffect((()=>{if(null!=c.current&&null!=a.current){(async()=>{try{const e=a.current,t=c.current,o={audio:!1,video:!0},r=await navigator.mediaDevices.getUserMedia(o);e.srcObject=r;const l=(o,r)=>{console.log("Setup video canvas, should happen once"),t.width=15e3,t.height=e.videoHeight,n({width:e.videoWidth,height:e.videoHeight})};e.requestVideoFrameCallback(l)}catch(e){alert(`${e.name}: ${e.message}`),console.log("navigator.MediaDevices.getUserMedia error: ",e.message,e.name)}})()}else console.warn("No refs yet in effect")}),[c.current,a.current]),e.createElement("div",{id:"container"},e.createElement("h1",null,"Webcam photo finish"),e.createElement("h2",null,"Webcam video (",null==t?void 0:t.width,"x",null==t?void 0:t.height,")"),e.createElement("video",{playsInline:!0,autoPlay:!0,ref:a,style:{backgroundColor:"#000000",width:"320px",height:"240px"}}),e.createElement("button",{onClick:()=>{if(null!=c.current&&null!=a.current){const e=a.current,t=c.current;console.log("INIT VIDEO"),l.current=!0;let n=0,o=0,s=null;t.width=15e3;let u=t.getContext("2d");const d=(a,c)=>{var m,h;let f,p;if(null===s&&(s=a,n=s),f=1*(n-s)%15e3,p=1*(a-n),o>f&&i(),null==(m=null==u?void 0:u.drawImage)||m.call(u,e,320,0,.2*(a-n),480,f,0,p,t.height),n=a,o=f,l.current)e.requestVideoFrameCallback(d);else{const e=t.toDataURL("image/png");null==(h=t.getContext("2d"))||h.clearRect(0,0,t.width,t.height),r((t=>[...t,e]))}};e.requestVideoFrameCallback(d)}}},"Start Capture"),e.createElement("button",{onClick:i},"Stop Capture"),e.createElement("button",{onClick:()=>{o.forEach(((e,t)=>{!function(e,t="download"){const n=URL.createObjectURL(e),o=document.createElement("a");o.href=n,o.download=t||"download";const r=()=>{setTimeout((()=>{URL.revokeObjectURL(n),o.removeEventListener("click",r)}),150)};o.addEventListener("click",r,!1),o.click()}(function(e){for(var t=atob(e.split(",")[1]),n=e.split(",")[0].split(":")[1].split(";")[0],o=new ArrayBuffer(t.length),r=new Uint8Array(o),l=0;l<t.length;l++)r[l]=t.charCodeAt(l);return new Blob([o],{type:n})}(e),`photo-finish-${function(e,t=4){var n="000000000"+e;return n.substr(n.length-t)}(t)}.png`)}))}},"Export all photos"),e.createElement("button",{onClick:()=>{r([])}},"Remove all photos"),e.createElement("h2",null,"Photo finish (Objects must be moving from ","Left To Right"," on the camera)"),e.createElement("canvas",{ref:c,style:{visibility:"hidden",display:"none",backgroundColor:"#000000",width:"100vw"}}),e.createElement("h2",null,"Blocks"),o.map(((t,n)=>e.createElement("img",{src:t,style:{width:"100vw",height:"240px"},key:n}))))}t.render(e.createElement(e.StrictMode,null,e.createElement(n,null)),document.getElementById("root"));
