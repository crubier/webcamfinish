import{r as e,a as t}from"./vendor.de62f314.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(n){const l=new URL(e,location),o=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((n,r)=>{const a=new URL(e,l);if(self[t].moduleMap[a])return n(self[t].moduleMap[a]);const c=new Blob([`import * as m from '${a}';`,`${t}.moduleMap['${a}']=m;`],{type:"text/javascript"}),i=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(c),onerror(){r(new Error(`Failed to import: ${e}`)),o(i)},onload(){n(self[t].moduleMap[a]),o(i)}});document.head.appendChild(i)})),self[t].moduleMap={}}}("/webcamfinish/assets/");function n(){const[t,n]=e.useState(null),[l,o]=e.useState([]),[r,a]=e.useState(!1),c=e.useRef(!1);e.useRef(!1);const i=e.useRef(null),s=e.useRef(null),u=()=>{c.current=!1};return e.useEffect((()=>{if(null!=s.current&&null!=i.current){(async()=>{try{const e=i.current,t=s.current,l={audio:!1,video:!0},o=await navigator.mediaDevices.getUserMedia(l);e.srcObject=o;const r=(l,o)=>{console.log("Setup video canvas, should happen once"),t.width=15e3,t.height=e.videoHeight,n({width:e.videoWidth,height:e.videoHeight})};e.requestVideoFrameCallback(r)}catch(e){alert(`${e.name}: ${e.message}`),console.log("navigator.MediaDevices.getUserMedia error: ",e.message,e.name)}})()}else console.warn("No refs yet in effect")}),[s.current,i.current]),e.createElement("div",{id:"container"},e.createElement("h1",null,"Webcam photo finish"),e.createElement("h2",null,"Webcam video (",null==t?void 0:t.width,"x",null==t?void 0:t.height,")"),e.createElement("video",{playsInline:!0,autoPlay:!0,ref:i,style:{backgroundColor:"#000000",width:"320px",height:"240px"}}),r?e.createElement("button",{onClick:u},"Stop Capture"):e.createElement("button",{onClick:()=>{if(null!=s.current&&null!=i.current){const e=i.current,t=s.current;a(!0),console.log("INIT VIDEO"),c.current=!0;let n=0,l=0,r=null;t.width=15e3;let d=t.getContext("2d");const m=(i,s)=>{var h,f;let p,g;if(null===r&&(r=i,n=r),p=1*(n-r)%15e3,g=1*(i-n),l>p&&u(),null==(h=null==d?void 0:d.drawImage)||h.call(d,e,320,0,.2*(i-n),480,p,0,g,t.height),n=i,l=p,c.current)e.requestVideoFrameCallback(m);else{const e=t.toDataURL("image/png");null==(f=t.getContext("2d"))||f.clearRect(0,0,t.width,t.height),a(!1),o((t=>[...t,e]))}};e.requestVideoFrameCallback(m)}}},"Start Capture"),(null==l?void 0:l.length)>0?e.createElement(e.Fragment,null,e.createElement("button",{onClick:()=>{l.forEach(((e,t)=>{!function(e,t="download"){const n=URL.createObjectURL(e),l=document.createElement("a");l.href=n,l.download=t||"download";const o=()=>{setTimeout((()=>{URL.revokeObjectURL(n),l.removeEventListener("click",o)}),150)};l.addEventListener("click",o,!1),l.click()}(function(e){for(var t=atob(e.split(",")[1]),n=e.split(",")[0].split(":")[1].split(";")[0],l=new ArrayBuffer(t.length),o=new Uint8Array(l),r=0;r<t.length;r++)o[r]=t.charCodeAt(r);return new Blob([l],{type:n})}(e),`photo-finish-${function(e,t=4){var n="000000000"+e;return n.substr(n.length-t)}(t)}.png`)}))}},"Export all photos"),e.createElement("button",{onClick:()=>{o([])}},"Remove all photos")):null,e.createElement("h2",null,"Photo finish (Objects must be moving from ","Left To Right"," on the camera)"),e.createElement("canvas",{ref:s,style:{visibility:"hidden",display:"none",backgroundColor:"#000000",width:"100vw"}}),e.createElement("h2",null,"Blocks"),l.map(((t,n)=>e.createElement("img",{src:t,style:{width:"100vw",height:"240px"},key:n}))))}t.render(e.createElement(e.StrictMode,null,e.createElement(n,null)),document.getElementById("root"));
